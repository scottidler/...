# vim: filetype=sh
KS="kube-system"
CW="CW"
HEADER_SORT1='(read -r; printf "%s\n" "$REPLY"; sort)'
HEADER_SORT2='(read -r; printf "%s\n" "$REPLY"; sort -k2)'
ETHDEV="ip route get 1.1.1.1 | grep -Po '(?<=dev\s)\w+' | cut -f1 -d ' '"
REPO_TEST="git rev-parse"
REPO_ROOT="git rev-parse --show-toplevel"
REPONAME_PN="s;^(git|ssh|https)://([A-Za-z0-9\-\_]+@)?([A-Za-z0-9\.]+)/;;"
BRANCH_NAME="git rev-parse --abbrev-ref HEAD"
REMOTE_ORIGIN_URL="git config --get remote.origin.url"
NEAREST_TAG="git describe --abbrev=0"

# global aliases, zsh only
if [[ "$(basename $SHELL)" == "zsh" ]]; then
    # disable annoying oh-my-zsh aliases
    disable -a \...
    disable -a \....
    disable -a \.....
    disable -a \......
    disable -a \1
    disable -a \2
    disable -a \3
    disable -a \4
    disable -a \5
    disable -a \6
    disable -a \7
    disable -a \8
    disable -a \9

    alias /="rg"
    alias //="rg --hidden"
    alias cd..="cd .."
    alias cd../=cd../""

    alias -g DE="DEPLOYED_ENV= #no-space"
    alias -g MB="\$(git merge-base master HEAD)"
    alias -g ST="SKIP_TESTS=yes"
    alias -g PP="PYTHONPATH=."
    alias -g WC="| wc -l"
    alias -g G="| grep -i"
    alias -g L="| less -r"
    alias -g H10="| head -10"
    alias -g H20="| head -20"
    alias -g T10="| tail -10"
    alias -g T20="| tail -20"
    alias -g F1="| cut -d' ' -f1"
    alias -g F2="| cut -d' ' -f2"
    alias -g F3="| cut -d' ' -f3"
    alias -g X="| xargs -I%"
    alias -g ns-cw="--namespace cw"
    alias -g ns-ks="--namespace kube-system"
    alias -g b64="| base64"
    alias -g b64d="| base64 -d"
    alias -g voy-ing="ingress.voyager.appscode.com"
    alias -g voy-crt="certificate.voyager.appscode.com"
    alias -g header-sort="| $HEADER_SORT1"
    alias -g pb="props-bot"
    alias -g nb="newbie-bot"
    alias -g ac="autocert"
    alias -g oj="-o json"
    alias -g oy="-o yaml"
    alias -g after---="awk 'f;/---/{f=1}'"
    alias -g tee2files="> >(tee -a stdout.log) 2> >(tee -a stderr.log >&2)"
    alias -g h-json="-H 'Accept: application/json'"
    alias -g xargs-bash="| xargs -I% bash -c 'echo %; tab2 "
fi

alias fail="sudo journalctl -xe"

alias R="rustc"
alias tf="terraform"
alias n="netlify"

alias clh="curl localhost: #no-space"

alias cat="ccat"

alias ethdev="echo \$($ETHDEV)"

alias os="echo \"\$(lsb_release -is)-\$(lsb_release -rs)_x\$(getconf LONG_BIT)(\$(lsb_release -cs))\""

alias login-subhub="aws-vault --debug exec mozilla-subhub-admin --"
alias login-subhub-token="aws-vault --debug login mozilla-subhub-admin -s --assume-role-ttl=1h --federation-token-ttl=12h"

alias aws-account-id="aws sts get-caller-identity | jq -r .Account"

alias untar="tar xvf"
alias T="tree -a -I '.git'"

# regular alises
alias udpate="update"
alias linode="ssh root@45.33.26.141"
alias fog="ssh -A saidler@45.33.26.141"
alias cl="clear"
alias pe="pipenv"

alias ip-lan='ip addr show |grep "inet " |grep -v 127.0.0. |head -1|cut -d" " -f6|cut -d/ -f1 #no-expand'
alias ip-pub="curl https://ifconfig.co"

alias pt="papertrail"
alias ds="dig +short"

alias ipy="sudo -E ipython3"
alias ipy2="sudo -E ipython"
alias ipy3="sudo -E ipython3"

alias cdr="\$($REPO_TEST) && cd \$($REPO_ROOT)"
alias cdpr="\$($REPO_TEST) && {cd ../; cd \$($REPO_ROOT)}"
alias cdp="\$($REPO_TEST) && cd \$($REPO_ROOT) && cd ../"

# projects
alias cd-repos="cd ~/repos"
alias cd-subhub="cd ~/repos/mozilla/subhub"
alias cd-autocert="cd ~/repos/mozilla-it/autocert"
alias cd-redirects="cd ~/repos/mozilla-it/netlify-redirects"
alias cd-newbie-bot="cd ~/repos/mozilla-it/newbie-bot"

alias d="docker"
alias dc="docker-compose"
alias dI="docker inspect"
alias di="docker images | $HEADER_SORT1"
alias dps="docker ps | $HEADER_SORT2"
alias dpsa="docker ps -a | $HEADER_SORT2"
alias dpsaq="docker ps -aq"
alias drm="docker rm"
alias drmi="docker rmi"
alias drit="docker run -it"
alias deit="docker exec -it"

alias pbcopy="xclip -selection clipboard"
alias pbpaste="xclip -selection clipboard -o"

alias k="kubectl"
alias ka="kubectl apply -f"
alias kg="kubectl get"
alias kga="kubectl get all"
alias kgC="kubectl get crd"
alias kgp="kubectl get pod"
alias kgs="kubectl get svc"
alias kgS="kubectl get secret"
alias kgd="kubectl get deployment"
alias kgc="kubectl get certificate"
alias kgv="kubectl get ingress.voyager.appscode.com"
alias kd="kubectl describe"
alias kdC="kubectl describe crd"
alias kdp="kubectl describe pod"
alias kds="kubectl describe svc"
alias kdS="kubectl describe secret"
alias kdd="kubectl describe deployment"
alias kdc="kubectl describe certificate"
alias kdv="kubectl describe ingress.voyager.appscode.com"
alias kD="kubectl delete"
alias kDC="kubectl delete crd"
alias kDp="kubectl delete pod"
alias kDs="kubectl delete svc"
alias kDS="kubectl delete secret"
alias kDd="kubectl delete deployment"
alias kv="kubectl version"
alias kvv="kubectl exec -it \$(kubectl get pods -n $CW -l app=voyager -o jsonpath={.items[0].metadata.name}) -n $CW voyager version"
alias kl="kubectl logs"

alias t="kubetpl"
alias tr="kubetpl render"

alias g="git"
alias ga="git add"
alias gb="git branch"
alias gc="git commit -m\" #no-space"
alias gcf="git cat-file -p"
alias gd="git diff"
alias gdm="git diff master"
alias gp="git pull"
alias gP="git push"
alias gpo="git push -u origin \$(git symbolic-ref --short -q HEAD)"
alias gs="git status --short"
alias gbc="git branch --contains"
alias gco="git checkout"
alias gcob="git checkout -b"
alias gcm="git checkout master"
alias grp="git rev-parse"
alias gsh="git show"
alias gsn="git show --notes=*"
alias gpP="gp && gP"
alias gbmm="git branch --merged master"
alias gbnmm="git branch --no-merged master"
alias grh="git reset --hard"
alias grhh="git reset --hard HEAD"
alias grph="git rev-parse HEAD"
alias gfbn="git fetch origin +refs/notes/buildno/:refs/notes/buildno"
alias gfofu="git fetch origin -f -u +refs/heads/*:refs/heads/*"
alias grloa="git rev-list --objects --all"
alias grm="git rebase master"
alias grim="git rebase -i master"
alias tags="git tag -l"
alias gl="git log"
alias gl1="git log -1"
alias gl2="git log -2"
alias gl3="git log -3"
alias gl4="git log -4"
alias gl5="git log -5"
alias gl6="git log -6"
alias gl7="git log -7"
alias gl8="git log -8"
alias gl9="git log -9"
alias repo-root="$REPO_ROOT"
alias branch="$BRANCH_NAME"
alias reponame="echo \$($REMOTE_ORIGIN_URL | sed -E '$REPONAME_PN')"
alias remote-origin-url="echo \$($REMOTE_ORIGIN_URL)"
alias ls-not-git="git ls-files . --ignored --exclude-standard --others"
alias ls-remote="git ls-remote \$($REMOTE_ORIGIN_URL)"
alias ls-remote-heads="git ls-remote \$($REMOTE_ORIGIN_URL) | grep refs/heads/"
alias ls-remote-branch="git ls-remote \$($REMOTE_ORIGIN_URL) | grep refs/heads/\$($BRANCH_NAME)"
alias ls-remote-tag="git ls-remote \$($REMOTE_ORIGIN_URL) | grep refs/tags/\$($NEAREST_TAG)"
alias not-on-master="git branch --no-merged master"
alias set-upstream="git branch --set-upstream-to=origin/\$(git rev-parse --abbrev-ref HEAD) \$(git rev-parse --abbrev-ref HEAD)"
alias prune="git remote prune origin"
alias unstage="git reset HEAD"
alias clean="git clean -xfd"

alias gbp="git-big-picture"

alias gsm="git submodule"
alias gsmu="gsm update"
alias gsmur="gsm update --remote"
alias gsmui="gsm update --jobs=$((3 * $(nproc))) --init --recursive"

alias bashrc="vim ~/.bashrc; . ~/.bashrc"
alias zshrc="vim ~/.zshrc; . ~/.zshrc"
alias aliases="vim ~/.shell-aliases; . ~/.zshrc"
alias exports="vim ~/.shell-exports; . ~/.zshrc"
alias functions="vim ~/.shell-functions; . ~/.zshrc"

alias ureboot="update && reboot"
alias ushutdown="update && shutdown"

alias grn="grep -rn"
alias pgrn="| grn"
alias egrn="egrep -rn"
alias pegrn="| egrn"
alias psgrep="ps aux | grep -v grep | grep"

alias moz="ssh sidler@moz.lan"
alias xps="ssh saidler@xps.lan"
alias mint="ssh saidler@mint.lan"
alias pffw="ssh saidler@pffw.lan"
alias fog="ssh saidler@fog.linode"

alias pip2="sudo -H python2 -m pip"
alias pip2.7="sudo -H python2.7 -m pip"
alias pip3="sudo -H python3 -m pip"
alias pip3-ii="sudo -H python3 -m pip install -U --ignore-installed"
alias pip3.6="sudo -H python3.6 -m pip"
alias pip3.6-ii="sudo -H python3.6 -m pip install -U --ignore-installed"
alias pip3.7="sudo -H python3.7 -m pip"
alias pip3.7-ii="sudo -H python3.7 -m pip install -U --ignore-installed"

alias xdo="xdotool"

alias clipboard="xclip -sel clip"
alias cb="clipboard"

alias irc="irccloud-search"
alias ap="ansible-playbook"

# enable color support of ls and also add handy aliases
if [ -x /usr/bin/dircolors ]; then
    test -r ~/.dircolors && eval "$(dircolors -b ~/.dircolors)" || eval "$(dircolors -b)"
    #alias dir="dir --color=auto"
    #alias vdir="vdir --color=auto"

    #alias ls='ls --color=auto #no-expand'
    alias grep='grep --color=auto'
    alias fgrep='fgrep --color=auto'
    alias egrep='egrep --color=auto'
fi

# colored GCC warnings and errors
#export GCC_COLORS='error=01;31:warning=01;35:note=01;36:caret=01;32:locus=01:quote=01'

# some more ls aliases
alias lah="ls-stat -lah --color=always"
alias ltr="ls-stat -ltr --color=always"
alias ll="ls-stat -alF --color=always"
alias la="ls-stat -A --color=always"
alias l="ls-stat -CF --color=always"

alias json2yaml="curl -sF \"json=@-\" https://x2y.rocks/yaml"
alias yaml2json="curl -sF \"yaml=@-\" https://x2y.rocks/json"
